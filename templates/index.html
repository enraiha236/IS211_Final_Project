{% extends "base.html" %}

{% block content %}
<h1>My Book Catalogue</h1>

<p>Logged in as: <strong>{{ session.user.username }}</strong></p>

<form method="POST" action="{{ url_for('search_isbn') }}">
    <input type="text" name="isbn" placeholder="Enter ISBN" required>
    <button type="submit">Add Book</button>
</form>

<form method="POST" action="{{ url_for('search_title') }}">
    <input type="text" name="title" placeholder="Search by Title" required>
    <button type="submit">Search</button>
</form>

{% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
    <ul class="messages">
    {% for category, message in messages %}
      <li class="{{ category }}">{{ message }}</li>
    {% endfor %}
    </ul>
  {% endif %}
{% endwith %}

{% if search_mode == "isbn" and isbn_results %}
<h2>ISBN Search Results</h2>
<ul>
{% for book in isbn_results %}
<li>
    <strong>{{ book.title }}</strong> by {{ book.author }} | Pages: {{ book.pages }} | Rating: {{ book.rating }}
    {% if book.thumb %}
        <br><img src="{{ book.thumb }}" width="80">
    {% endif %}
    <form action="{{ url_for('add_book') }}" method="POST">
        <input type="hidden" name="title" value="{{ book.title }}">
        <input type="hidden" name="author" value="{{ book.author }}">
        <input type="hidden" name="pages" value="{{ book.pages }}">
        <input type="hidden" name="rating" value="{{ book.rating }}">
        <input type="hidden" name="thumb" value="{{ book.thumb }}">
        <button type="submit">Add Book</button>
    </form>
</li>
{% endfor %}
</ul>
{% elif search_mode == "title" and title_results %}
<h2>Title Search Results</h2>
<ul>
{% for book in title_results %}
<li>
    <strong>{{ book.title }}</strong> by {{ book.author }} | Pages: {{ book.pages }} | Rating: {{ book.rating }}
    {% if book.thumb %}
        <br><img src="{{ book.thumb }}" width="80">
    {% endif %}
    <form action="{{ url_for('add_book') }}" method="POST">
        <input type="hidden" name="title" value="{{ book.title }}">
        <input type="hidden" name="author" value="{{ book.author }}">
        <input type="hidden" name="pages" value="{{ book.pages }}">
        <input type="hidden" name="rating" value="{{ book.rating }}">
        <input type="hidden" name="thumb" value="{{ book.thumb }}">
        <button type="submit">Add Book</button>
    </form>
</li>
{% endfor %}
</ul>
{% endif %}

<h2>My Books</h2>
<ul class="book-list">
{% for book in books %}
<li>
    <strong>{{ book.title }}</strong> by {{ book.author }} | Pages: {{ book.pages }} | Rating: {{ book.rating }}
    {% if book.thumb %}
        <br><img src="{{ book.thumb }}" width="80">
    {% endif %}
    <form action="{{ url_for('delete', index=loop.index0) }}" method="POST" style="display:inline;">
        <button type="submit">Delete</button>
    </form>
</li>
{% endfor %}
</ul>

<form action="{{ url_for('logout') }}" method="POST" class="mt-4">
    <button type="submit">Logout</button>
</form>

{% endblock %}